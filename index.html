<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2677.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d6d6d; -webkit-text-stroke: #6d6d6d}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6b0001; -webkit-text-stroke: #6b0001}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #fb0007; -webkit-text-stroke: #fb0007}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0000ff; -webkit-text-stroke: #0000ff}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4d5055; -webkit-text-stroke: #4d5055}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #18702b; -webkit-text-stroke: #18702b}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000; min-height: 16.0px}
    span.s1 {font-kerning: none; background-color: #ecf1f7}
    span.s2 {font-kerning: none; color: #fb0007; background-color: #ecf1f7; -webkit-text-stroke: 0px #fb0007}
    span.s3 {font-kerning: none; color: #2a2a2a; background-color: #ecf1f7; -webkit-text-stroke: 0px #2a2a2a}
    span.s4 {font-kerning: none; color: #000000; background-color: #ecf1f7; -webkit-text-stroke: 0px #000000}
    span.s5 {font-kerning: none; color: #0000ff; background-color: #ecf1f7; -webkit-text-stroke: 0px #0000ff}
    span.s6 {font-kerning: none; color: #6b0001; background-color: #ecf1f7; -webkit-text-stroke: 0px #6b0001}
    span.s7 {font-kerning: none; color: #6f0ec3; background-color: #ecf1f7; -webkit-text-stroke: 0px #6f0ec3}
    span.s8 {font-kerning: none; color: #18702b; background-color: #ecf1f7; -webkit-text-stroke: 0px #18702b}
    span.s9 {font-kerning: none}
    span.s10 {font-kerning: none; color: #4d5055; background-color: #ecf1f7; -webkit-text-stroke: 0px #4d5055}
    span.s11 {font-kerning: none; color: #a4450b; background-color: #ecf1f7; -webkit-text-stroke: 0px #a4450b}
    span.s12 {font-kerning: none; color: #bf1c25; background-color: #ecf1f7; -webkit-text-stroke: 0px #bf1c25}
    span.s13 {font-kerning: none; color: #0e6e6d; background-color: #ecf1f7; -webkit-text-stroke: 0px #0e6e6d}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"cs"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">Swing Trader App</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">&lt;!-- Firebase SDKs --&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"module"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s4"> { initializeApp } </span><span class="s7">from</span><span class="s4"> </span><span class="s1">"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } </span><span class="s7">from</span><span class="s1"> </span><span class="s8">"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">import</span><span class="s1"> { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs } </span><span class="s7">from</span><span class="s1"> </span><span class="s8">"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Function to show a custom message box (defined globally for accessibility)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">function</span><span class="s1"> showMessage(message, type = </span><span class="s8">'warning'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> messageBox = document.getElementById(</span><span class="s8">'messageBox'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> messageText = document.getElementById(</span><span class="s8">'messageText'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (messageBox &amp;&amp; messageText) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageText.textContent = message;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageBox.className = </span><span class="s8">'message-box'</span><span class="s1">; </span><span class="s10">// Reset classes</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (type === </span><span class="s8">'error'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageBox.classList.add(</span><span class="s8">'bg-red-100'</span><span class="s1">, </span><span class="s8">'text-red-800'</span><span class="s1">, </span><span class="s8">'border-red-400'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (type === </span><span class="s8">'success'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageBox.classList.add(</span><span class="s8">'bg-green-100'</span><span class="s1">, </span><span class="s8">'text-green-800'</span><span class="s1">, </span><span class="s8">'border-green-400'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> { </span><span class="s10">// Default to warning</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageBox.classList.add(</span><span class="s8">'bg-yellow-100'</span><span class="s1">, </span><span class="s8">'text-yellow-800'</span><span class="s1">, </span><span class="s8">'border-yellow-400'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageBox.style.display = </span><span class="s8">'block'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>setTimeout(() =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>messageBox.style.display = </span><span class="s8">'none'</span><span class="s1">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>}, </span><span class="s11">5000</span><span class="s4">); </span><span class="s1">// Hide after 5 seconds</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.warn(</span><span class="s8">"Message box elements not found:"</span><span class="s1">, message);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>document.addEventListener(</span><span class="s8">'DOMContentLoaded'</span><span class="s1">, </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> db;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> auth;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> userId;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> isAuthReady = </span><span class="s7">false</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Data arrays (will be populated from Firestore)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> initialBalance = </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> trades = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> withdrawals = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> plannedTrades = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> tradeQuestions = [];</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Temporary storage for planned trade being added/edited</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> currentPlannedTradeToEdit = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// DOM elements - assigned AFTER DOMContentLoaded to ensure they exist</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> initialBalanceInput = document.getElementById(</span><span class="s8">'initialBalanceInput'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> setInitialBalanceBtn = document.getElementById(</span><span class="s8">'setInitialBalanceBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> availableBalanceDisplay = document.getElementById(</span><span class="s8">'availableBalanceDisplay'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> investedBalanceDisplay = document.getElementById(</span><span class="s8">'investedBalanceDisplay'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totalWithdrawalsDisplay = document.getElementById(</span><span class="s8">'totalWithdrawalsDisplay'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> userIdDisplay = document.getElementById(</span><span class="s8">'userIdDisplay'</span><span class="s1">); </span><span class="s10">// Get reference to userIdDisplay</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> withdrawalAmountInput = document.getElementById(</span><span class="s8">'withdrawalAmountInput'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> recordWithdrawalBtn = document.getElementById(</span><span class="s8">'recordWithdrawalBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> viewWithdrawalHistoryBtn = document.getElementById(</span><span class="s8">'viewWithdrawalHistoryBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> withdrawalHistoryModal = document.getElementById(</span><span class="s8">'withdrawalHistoryModal'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> withdrawalList = document.getElementById(</span><span class="s8">'withdrawalList'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> closeWithdrawalHistoryBtn = document.getElementById(</span><span class="s8">'closeWithdrawalHistoryBtn'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> tradeStockSymbol = document.getElementById(</span><span class="s8">'tradeStockSymbol'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> tradeBuyPrice = document.getElementById(</span><span class="s8">'tradeBuyPrice'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> tradeQuantity = document.getElementById(</span><span class="s8">'tradeQuantity'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> tradeBuyFee = document.getElementById(</span><span class="s8">'tradeBuyFee'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> tradeDate = document.getElementById(</span><span class="s8">'tradeDate'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> addTradeBtn = document.getElementById(</span><span class="s8">'addTradeBtn'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> openTradeList = document.getElementById(</span><span class="s8">'openTradeList'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> closedTradeList = document.getElementById(</span><span class="s8">'closedTradeList'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> openTradesTab = document.getElementById(</span><span class="s8">'openTradesTab'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> closedTradesTab = document.getElementById(</span><span class="s8">'closedTradesTab'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> openTradesSection = document.getElementById(</span><span class="s8">'openTradesSection'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> closedTradesSection = document.getElementById(</span><span class="s8">'closedTradesSection'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totalProfitLossDisplay = document.getElementById(</span><span class="s8">'totalProfitLoss'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totalTaxPaidDisplay = document.getElementById(</span><span class="s8">'totalTaxPaid'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> sellModal = document.getElementById(</span><span class="s8">'sellModal'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> modalSymbol = document.getElementById(</span><span class="s8">'modalSymbol'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> modalQuantity = document.getElementById(</span><span class="s8">'modalQuantity'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> modalSellPrice = document.getElementById(</span><span class="s8">'modalSellPrice'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> modalSellFee = document.getElementById(</span><span class="s8">'modalSellFee'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> modalSellDate = document.getElementById(</span><span class="s8">'modalSellDate'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> cancelSellBtn = document.getElementById(</span><span class="s8">'cancelSellBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> confirmSellBtn = document.getElementById(</span><span class="s8">'confirmSellBtn'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editModal = document.getElementById(</span><span class="s8">'editModal'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editTradeId = document.getElementById(</span><span class="s8">'editTradeId'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editSymbol = document.getElementById(</span><span class="s8">'editSymbol'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editBuyPrice = document.getElementById(</span><span class="s8">'editBuyPrice'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editQuantity = document.getElementById(</span><span class="s8">'editQuantity'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editBuyFee = document.getElementById(</span><span class="s8">'editBuyFee'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editTradeDate = document.getElementById(</span><span class="s8">'editTradeDate'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editSellPrice = document.getElementById(</span><span class="s8">'editSellPrice'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editSellFee = document = document.getElementById(</span><span class="s8">'editSellFee'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editSellDate = document.getElementById(</span><span class="s8">'editSellDate'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editExitStrategy = document.getElementById(</span><span class="s8">'editExitStrategy'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editSellPriceGroup = document.getElementById(</span><span class="s8">'editSellPriceGroup'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editSellFeeGroup = document.getElementById(</span><span class="s8">'editSellFeeGroup'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editSellDateGroup = document.getElementById(</span><span class="s8">'editSellDateGroup'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> editExitStrategyGroup = document.getElementById(</span><span class="s8">'editExitStrategyGroup'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> cancelEditBtn = document.getElementById(</span><span class="s8">'cancelEditBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> confirmEditBtn = document.getElementById(</span><span class="s8">'confirmEditBtn'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> plannedCompanyInput = document.getElementById(</span><span class="s8">'plannedCompany'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> plannedEntryPriceInput = document.getElementById(</span><span class="s8">'plannedEntryPrice'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> plannedExitPriceInput = document.getElementById(</span><span class="s8">'plannedExitPrice'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> plannedQuantityInput = document.getElementById(</span><span class="s8">'plannedQuantity'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> addPlannedTradeBtn = document.getElementById(</span><span class="s8">'addPlannedTradeBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> plannedTradeList = document.getElementById(</span><span class="s8">'plannedTradeList'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> totalPlannedInvestedDisplay = document.getElementById(</span><span class="s8">'totalPlannedInvestedDisplay'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> availableForPlannedInvestmentDisplay = document.getElementById(</span><span class="s8">'availableForPlannedInvestmentDisplay'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> plannedTradeQuestionsModal = document.getElementById(</span><span class="s8">'plannedTradeQuestionsModal'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> questionsContainer = document.getElementById(</span><span class="s8">'questionsContainer'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> cancelQuestionsBtn = document.getElementById(</span><span class="s8">'cancelQuestionsBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> confirmQuestionsBtn = document.getElementById(</span><span class="s8">'confirmQuestionsBtn'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> manageQuestionsBtn = document.getElementById(</span><span class="s8">'manageQuestionsBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> manageQuestionsModal = document.getElementById(</span><span class="s8">'manageQuestionsModal'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> currentQuestionsList = document.getElementById(</span><span class="s8">'currentQuestionsList'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> newQuestionInput = document.getElementById(</span><span class="s8">'newQuestionInput'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> addNewQuestionBtn = document.getElementById(</span><span class="s8">'addNewQuestionBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> cancelManageQuestionsBtn = document.getElementById(</span><span class="s8">'cancelManageQuestionsBtn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> saveQuestionsBtn = document.getElementById(</span><span class="s8">'saveQuestionsBtn'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// ZDE VLOŽ SVOU firebaseConfig Z KROKU 1.3</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">// Příklad:</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> firebaseConfig = {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                  </span>apiKey: </span><span class="s1">"AIzaSyC54QRT-WNT8Cmqk61HzjyFYAASSmWg"</span><span class="s4">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                  </span>authDomain: </span><span class="s1">"swing-app-e391c.firebaseapp.com"</span><span class="s4">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>projectId: </span><span class="s8">"swing-app-e391c"</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>storageBucket: </span><span class="s8">"swing-app-e391c.appspot.com"</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>messagingSenderId: </span><span class="s8">"262459838769"</span><span class="s1">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                  </span>appId: </span><span class="s1">"1:262459838769:web:997c7a1a7eb4bb5866ea6d2c"</span><span class="s4">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                  </span>measurementId: </span><span class="s8">"G-XX0VX8NL5J"</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>};</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Původní řádek: const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (!firebaseConfig || !firebaseConfig.apiKey) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s1">"Firebase configuration is missing or invalid. Data will not be saved to Firestore."</span><span class="s4">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">"Chyba: Firebase konfigurace chybí. Data nebudou uložena do cloudu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> firebaseApp = initializeApp(firebaseConfig);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>db = getFirestore(firebaseApp);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>auth = getAuth(firebaseApp);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">// Původní kód:</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// if (typeof __initial_auth_token !== 'undefined' &amp;&amp; __initial_auth_token) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// <span class="Apple-converted-space">    </span>await signInWithCustomToken(auth, __initial_auth_token);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">// } else {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// <span class="Apple-converted-space">    </span>await signInAnonymously(auth);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">// }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s10">// NOVÝ KÓD:</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">await</span><span class="s4"> signInAnonymously(auth); </span><span class="s1">// Pro GitHub Pages se přihlašujeme anonymně</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>onAuthStateChanged(auth, (user) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (user) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>userId = user.uid;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>isAuthReady = </span><span class="s7">true</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (userIdDisplay) userIdDisplay.textContent = </span><span class="s8">`Uživatel: </span><span class="s1">${userId}</span><span class="s8">`</span><span class="s1">; </span><span class="s10">// Check if element exists</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>loadDataFromFirestore();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>attachAllEventListenersToDomElements(); </span><span class="s10">// Call this function here</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                        </span>showMessage(</span><span class="s1">"Úspěšně připojeno k cloudu. Data se načítají..."</span><span class="s4">, </span><span class="s1">"success"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>userId = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>isAuthReady = </span><span class="s7">true</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (userIdDisplay) userIdDisplay.textContent = </span><span class="s8">`Uživatel: Nepřihlášen`</span><span class="s1">; </span><span class="s10">// Check if element exists</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                        </span>showMessage(</span><span class="s1">"Nepřihlášeno k Firebase. Data nebudou uložena do cloudu."</span><span class="s4">, </span><span class="s1">"warning"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">catch</span><span class="s1"> (error) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>console.error(</span><span class="s8">"Error initializing Firebase:"</span><span class="s1">, error);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showMessage(</span><span class="s1">"Chyba při inicializaci Firebase. Data nebudou uložena do cloudu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Function to load all data from Firestore</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> loadDataFromFirestore() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (!isAuthReady || !userId) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>console.warn(</span><span class="s1">"Firebase not ready or user not authenticated. Cannot load data."</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// __app_id je proměnná poskytovaná prostředím Canvasu.</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Pro GitHub Pages si ji můžeš definovat pevně, nebo ji nechat jako 'default-app-id'.</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Pro účely GitHub Pages je bezpečné ji nechat jako 'default-app-id',</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// protože tvá data jsou chráněna tvým userId.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> appId = </span><span class="s7">typeof</span><span class="s1"> __app_id !== </span><span class="s8">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s8">'default-app-id'</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>onSnapshot(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/initialBalance`</span><span class="s1">, </span><span class="s8">'balance'</span><span class="s1">), (docSnap) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (docSnap.exists()) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>initialBalance = docSnap.data().amount || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (initialBalanceInput) initialBalanceInput.value = initialBalance;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>initialBalance = </span><span class="s11">86364</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (initialBalanceInput) initialBalanceInput.value = initialBalance;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>setDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/initialBalance`</span><span class="s1">, </span><span class="s8">'balance'</span><span class="s1">), { amount: initialBalance });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>updateSummary();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}, (error) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error fetching initial balance:"</span><span class="s1">, error);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">"Chyba při načítání počátečního zůstatku."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>onSnapshot(collection(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/trades`</span><span class="s1">), (snapshot) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>trades = snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>renderTrades();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>updateSummary();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}, (error) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error fetching trades:"</span><span class="s1">, error);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s8">"Chyba při načítání obchodů."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>onSnapshot(collection(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/withdrawals`</span><span class="s1">), (snapshot) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>withdrawals = snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>renderWithdrawalHistory();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>updateSummary();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}, (error) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error fetching withdrawals:"</span><span class="s1">, error);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s8">"Chyba při načítání výběrů."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>onSnapshot(collection(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/plannedTrades`</span><span class="s1">), (snapshot) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>plannedTrades = snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>renderPlannedTrades();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>updateSummary();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}, (error) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error fetching planned trades:"</span><span class="s1">, error);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">"Chyba při načítání plánovaných obchodů."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>onSnapshot(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/tradeQuestions`</span><span class="s1">, </span><span class="s8">'questions'</span><span class="s1">), (docSnap) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (docSnap.exists()) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>tradeQuestions = docSnap.data().list || [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>tradeQuestions = [</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>{ id: crypto.randomUUID(), text: </span><span class="s8">"Akcie v dlouhodobém růstu?"</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>{ id: crypto.randomUUID(), text: </span><span class="s8">"Akcie dnes v růstu?"</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>{ id: crypto.randomUUID(), text: </span><span class="s8">"Kupuješ bez emocí a bez FOMO?"</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>{ id: crypto.randomUUID(), text: </span><span class="s8">"Je to opak padajícího nože?"</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>{ id: crypto.randomUUID(), text: </span><span class="s8">"Kupuješ v pullbacku v růstovém trendu?"</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>{ id: crypto.randomUUID(), text: </span><span class="s8">"Máš ze vstupu dobrý pocit?"</span><span class="s1"> },</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>{ id: crypto.randomUUID(), text: </span><span class="s1">"Nastavuješ STOPLOSS-u rizikových firem na ztrátu max. 25usd a u kvalitních firem (Nvidia..) v růstu na 150usd?"</span><span class="s4"> }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>setDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/tradeQuestions`</span><span class="s1">, </span><span class="s8">'questions'</span><span class="s1">), { list: tradeQuestions });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>renderManageQuestionsModal();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}, (error) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error fetching trade questions:"</span><span class="s1">, error);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">"Chyba při načítání otázek pro plánované obchody."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Function to calculate potential profit for open trades</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> calculatePotentialProfit(buyPrice, quantity, buyFee, exitStrategy) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (isNaN(buyPrice) || isNaN(quantity) || isNaN(buyFee) || isNaN(exitStrategy) || exitStrategy &lt;= </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1"> </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> grossProfit = (exitStrategy - buyPrice) * quantity;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1"> grossProfit - (buyFee || </span><span class="s11">0</span><span class="s1">) - (buyFee || </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Function to calculate planned profit</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> calculatePlannedProfit(entryPrice, exitPrice, quantity) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (isNaN(entryPrice) || isNaN(exitPrice) || isNaN(quantity) || entryPrice &lt;= </span><span class="s11">0</span><span class="s1"> || exitPrice &lt;= </span><span class="s11">0</span><span class="s1"> || quantity &lt;= </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">return</span><span class="s1"> </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1"> (exitPrice - entryPrice) * quantity;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Function to update all summary displays</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> updateSummary() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> totalRealizedPL = </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> totalInvestedInOpenTrades = </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> totalPlannedInvested = </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>trades.forEach(trade =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (trade.status === </span><span class="s8">'closed'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>totalRealizedPL += trade.profitLoss;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (trade.status === </span><span class="s8">'open'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>totalInvestedInOpenTrades += trade.costBasis;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>plannedTrades.forEach(plannedTrade =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>totalPlannedInvested += (plannedTrade.entryPrice * plannedTrade.quantity) || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">let</span><span class="s1"> totalTax = </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (totalRealizedPL &gt; </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>totalTax = totalRealizedPL * </span><span class="s11">0.15</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> totalWithdrawals = withdrawals.reduce((sum, withdrawal) =&gt; sum + withdrawal.amount, </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> currentAvailableBalance = initialBalance - totalWithdrawals - totalInvestedInOpenTrades;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> availableForPlannedInvestment = currentAvailableBalance - totalPlannedInvested;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (availableBalanceDisplay) availableBalanceDisplay.textContent = </span><span class="s8">`</span><span class="s12">$</span><span class="s1">${currentAvailableBalance.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (investedBalanceDisplay) investedBalanceDisplay.textContent = </span><span class="s8">`</span><span class="s12">$</span><span class="s1">${totalInvestedInOpenTrades.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (totalProfitLossDisplay) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>totalProfitLossDisplay.textContent = </span><span class="s8">`</span><span class="s12">$</span><span class="s1">${totalRealizedPL.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>totalProfitLossDisplay.classList.remove(</span><span class="s8">'profit'</span><span class="s1">, </span><span class="s8">'loss'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (totalRealizedPL &gt;= </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>totalProfitLossDisplay.classList.add(</span><span class="s8">'profit'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>totalProfitLossDisplay.classList.add(</span><span class="s8">'loss'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (totalTaxPaidDisplay) totalTaxPaidDisplay.textContent = </span><span class="s8">`</span><span class="s12">$</span><span class="s1">${totalTax.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (totalWithdrawalsDisplay) totalWithdrawalsDisplay.textContent = </span><span class="s8">`</span><span class="s12">$</span><span class="s1">${totalWithdrawals.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (totalPlannedInvestedDisplay) totalPlannedInvestedDisplay.textContent = </span><span class="s8">`</span><span class="s12">$</span><span class="s1">${totalPlannedInvested.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (availableForPlannedInvestmentDisplay) availableForPlannedInvestmentDisplay.textContent = </span><span class="s8">`</span><span class="s12">$</span><span class="s1">${availableForPlannedInvestment.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Render functions</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> renderTrades() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (!openTradeList || !closedTradeList) </span><span class="s7">return</span><span class="s1">; </span><span class="s10">// Ensure elements exist</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>openTradeList.innerHTML = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>closedTradeList.innerHTML = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> openTrades = trades.filter(trade =&gt; trade.status === </span><span class="s8">'open'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> closedTrades = trades.filter(trade =&gt; trade.status === </span><span class="s8">'closed'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (openTrades.length === </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>openTradeList.innerHTML = </span><span class="s1">`&lt;tr&gt;&lt;td colspan="9" class="text-center text-gray-500 py-4"&gt;Žádné otevřené obchody.&lt;/td&gt;&lt;/tr&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>openTrades.forEach((trade) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> potentialProfit = calculatePotentialProfit(trade.buyPrice, trade.quantity, trade.buyFee, trade.exitStrategy);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> profitClass = potentialProfit &gt;= </span><span class="s11">0</span><span class="s1"> ? </span><span class="s8">'profit'</span><span class="s1"> : </span><span class="s8">'loss'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> row = document.createElement(</span><span class="s8">'tr'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>row.innerHTML = </span><span class="s8">`</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${trade.</span><span class="s7">symbol</span><span class="s4">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${trade.buyPrice.toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${trade.quantity}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${(trade.buyFee || </span><span class="s11">0</span><span class="s4">).toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${(trade.costBasis || </span><span class="s11">0</span><span class="s4">).toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${trade.date}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;&lt;input type="number" class="exit-strategy-input p-2 border rounded-md w-24" data-trade-id="</span><span class="s4">${trade.id}</span><span class="s1">" value="</span><span class="s4">${trade.exitStrategy !== </span><span class="s7">null</span><span class="s4"> ? trade.exitStrategy : </span><span class="s1">''</span><span class="s4">}</span><span class="s1">" step="0.01"&gt;&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td class="</span><span class="s4">${profitClass}</span><span class="s1">"&gt;</span><span class="s12">$</span><span class="s4">${potentialProfit.toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button data-id="</span><span class="s4">${trade.id}</span><span class="s1">" class="text-blue-500 hover:text-blue-700 font-semibold sell-trade-btn mr-2"&gt;Prodat&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button data-id="</span><span class="s4">${trade.id}</span><span class="s1">" class="text-indigo-500 hover:text-indigo-700 font-semibold edit-trade-btn mr-2"&gt;Upravit&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button data-id="</span><span class="s4">${trade.id}</span><span class="s1">" class="text-red-500 hover:text-red-700 font-semibold delete-trade-btn"&gt;Smazat&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>openTradeList.appendChild(row);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (closedTrades.length === </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>closedTradeList.innerHTML = </span><span class="s1">`&lt;tr&gt;&lt;td colspan="10" class="text-center text-gray-500 py-4"&gt;Žádné uzavřené obchody.&lt;/td&gt;&lt;/tr&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>closedTrades.forEach((trade) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> profitLossClass = trade.profitLoss &gt;= </span><span class="s11">0</span><span class="s1"> ? </span><span class="s8">'profit'</span><span class="s1"> : </span><span class="s8">'loss'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> row = document.createElement(</span><span class="s8">'tr'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>row.innerHTML = </span><span class="s8">`</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${trade.</span><span class="s7">symbol</span><span class="s4">}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${trade.buyPrice.toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${trade.sellPrice.toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${trade.quantity}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p5"><span class="s8"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s1">${((trade.buyFee || </span><span class="s11">0</span><span class="s1">) + (trade.sellFee || </span><span class="s11">0</span><span class="s1">)).toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">&lt;/td&gt;</span></p>
<p class="p5"><span class="s8"><span class="Apple-converted-space">                            </span>&lt;td class="</span><span class="s1">${profitLossClass}</span><span class="s8">"&gt;</span><span class="s12">$</span><span class="s1">${trade.profitLoss.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${(trade.tax || </span><span class="s11">0</span><span class="s4">).toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${trade.date}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${trade.sellDate}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button data-id="</span><span class="s4">${trade.id}</span><span class="s1">" class="text-indigo-500 hover:text-indigo-700 font-semibold edit-trade-btn mr-2"&gt;Upravit&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button data-id="</span><span class="s4">${trade.id}</span><span class="s1">" class="text-red-500 hover:text-red-700 font-semibold delete-trade-btn-closed"&gt;Smazat&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>closedTradeList.appendChild(row);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>attachEventListeners();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> renderPlannedTrades() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (!plannedTradeList) </span><span class="s7">return</span><span class="s1">; </span><span class="s10">// Ensure element exists</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>plannedTradeList.innerHTML = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (plannedTrades.length === </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>plannedTradeList.innerHTML = </span><span class="s1">`&lt;tr&gt;&lt;td colspan="7" class="text-center text-gray-500 py-4"&gt;Žádné plánované obchody.&lt;/td&gt;&lt;/tr&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>plannedTrades.forEach(plannedTrade =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> plannedProfit = calculatePlannedProfit(plannedTrade.entryPrice, plannedTrade.exitPrice, plannedTrade.quantity);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> profitClass = plannedProfit &gt;= </span><span class="s11">0</span><span class="s1"> ? </span><span class="s8">'profit'</span><span class="s1"> : </span><span class="s8">'loss'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> investedAmount = plannedTrade.entryPrice * plannedTrade.quantity;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> row = document.createElement(</span><span class="s8">'tr'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>row.innerHTML = </span><span class="s8">`</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${plannedTrade.company}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${plannedTrade.entryPrice.toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${plannedTrade.exitPrice.toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${plannedTrade.quantity}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${investedAmount.toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td class="</span><span class="s4">${profitClass}</span><span class="s1">"&gt;</span><span class="s12">$</span><span class="s4">${plannedProfit.toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button data-id="</span><span class="s4">${plannedTrade.id}</span><span class="s1">" class="text-indigo-500 hover:text-indigo-700 font-semibold edit-planned-trade-btn mr-2"&gt;Upravit&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button data-id="</span><span class="s4">${plannedTrade.id}</span><span class="s1">" class="text-red-500 hover:text-red-700 font-semibold delete-planned-trade-btn"&gt;Smazat&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>plannedTradeList.appendChild(row);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>attachPlannedTradeEventListeners();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>updateSummary();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> renderWithdrawalHistory() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (!withdrawalList) </span><span class="s7">return</span><span class="s1">; </span><span class="s10">// Ensure element exists</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>withdrawalList.innerHTML = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (withdrawals.length === </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>withdrawalList.innerHTML = </span><span class="s1">`&lt;tr&gt;&lt;td colspan="3" class="text-center text-gray-500 py-4"&gt;Žádné zaznamenané výběry.&lt;/td&gt;&lt;/tr&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>withdrawals.forEach(withdrawal =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> row = document.createElement(</span><span class="s8">'tr'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>row.innerHTML = </span><span class="s8">`</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s4">${withdrawal.date}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span><span class="s12">$</span><span class="s4">${withdrawal.amount.toFixed(</span><span class="s11">2</span><span class="s4">)}</span><span class="s1">&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button data-id="</span><span class="s4">${withdrawal.id}</span><span class="s1">" class="text-red-500 hover:text-red-700 font-semibold delete-withdrawal-btn"&gt;Smazat&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/td&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>withdrawalList.appendChild(row);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>attachWithdrawalEventListeners();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Attach event listeners for dynamically created elements</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> attachEventListeners() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.querySelectorAll(</span><span class="s8">'.exit-strategy-input'</span><span class="s1">).forEach(input =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>input.removeEventListener(</span><span class="s8">'change'</span><span class="s1">, handleExitStrategyChange);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>input.addEventListener(</span><span class="s8">'change'</span><span class="s1">, handleExitStrategyChange);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.querySelectorAll(</span><span class="s8">'.sell-trade-btn'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.removeEventListener(</span><span class="s8">'click'</span><span class="s1">, handleSellButtonClick);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.addEventListener(</span><span class="s8">'click'</span><span class="s1">, handleSellButtonClick);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.querySelectorAll(</span><span class="s8">'.edit-trade-btn'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.removeEventListener(</span><span class="s8">'click'</span><span class="s1">, handleEditButtonClick);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.addEventListener(</span><span class="s8">'click'</span><span class="s1">, handleEditButtonClick);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.querySelectorAll(</span><span class="s8">'.delete-trade-btn'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.removeEventListener(</span><span class="s8">'click'</span><span class="s1">, handleDeleteOpenTrade);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.addEventListener(</span><span class="s8">'click'</span><span class="s1">, handleDeleteOpenTrade);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.querySelectorAll(</span><span class="s8">'.delete-trade-btn-closed'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.removeEventListener(</span><span class="s8">'click'</span><span class="s1">, handleDeleteClosedTrade);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.addEventListener(</span><span class="s8">'click'</span><span class="s1">, handleDeleteClosedTrade);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> attachPlannedTradeEventListeners() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.querySelectorAll(</span><span class="s8">'.edit-planned-trade-btn'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.removeEventListener(</span><span class="s8">'click'</span><span class="s1">, handleEditPlannedTrade);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.addEventListener(</span><span class="s8">'click'</span><span class="s1">, handleEditPlannedTrade);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.querySelectorAll(</span><span class="s8">'.delete-planned-trade-btn'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.removeEventListener(</span><span class="s8">'click'</span><span class="s1">, handleDeletePlannedTrade);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.addEventListener(</span><span class="s8">'click'</span><span class="s1">, handleDeletePlannedTrade);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> attachWithdrawalEventListeners() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.querySelectorAll(</span><span class="s8">'.delete-withdrawal-btn'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.removeEventListener(</span><span class="s8">'click'</span><span class="s1">, handleDeleteWithdrawal);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.addEventListener(</span><span class="s8">'click'</span><span class="s1">, handleDeleteWithdrawal);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Event Handlers</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handleExitStrategyChange(event) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s4"> (!userId) { showMessage(</span><span class="s1">"Uživatel není přihlášen. Data nelze uložit."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">); </span><span class="s7">return</span><span class="s4">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> tradeId = event.target.dataset.id; </span><span class="s10">// Corrected to use data-id</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> newExitStrategy = parseFloat(event.target.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> tradeRef = doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${__app_id}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/trades`</span><span class="s1">, tradeId);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (!isNaN(newExitStrategy) &amp;&amp; newExitStrategy &gt;= </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">await</span><span class="s1"> updateDoc(tradeRef, { exitStrategy: newExitStrategy });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>showMessage(</span><span class="s8">'Exit Strategy aktualizována.'</span><span class="s1">, </span><span class="s8">'success'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (event.target.value === </span><span class="s8">''</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">await</span><span class="s1"> updateDoc(tradeRef, { exitStrategy: </span><span class="s7">null</span><span class="s1"> });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>showMessage(</span><span class="s8">'Exit Strategy vymazána.'</span><span class="s1">, </span><span class="s8">'success'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                        </span>showMessage(</span><span class="s1">'Zadejte prosím platnou kladnou hodnotu pro Exit Strategy, nebo nechte prázdné.'</span><span class="s4">, </span><span class="s1">'error'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error updating exit strategy:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">"Chyba při aktualizaci Exit Strategy."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> handleSellButtonClick(event) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> tradeIdToSell = event.target.dataset.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>currentTradeToSell = trades.find(t =&gt; t.id === tradeIdToSell &amp;&amp; t.status === </span><span class="s8">'open'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (currentTradeToSell) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (modalSymbol) modalSymbol.textContent = currentTradeToSell.</span><span class="s7">symbol</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (modalQuantity) modalQuantity.textContent = currentTradeToSell.quantity;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (modalSellPrice) modalSellPrice.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (modalSellFee) modalSellFee.value = (currentTradeToSell.buyFee || </span><span class="s11">0</span><span class="s1">).toFixed(</span><span class="s11">2</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (modalSellDate) modalSellDate.value = </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Date</span><span class="s1">().toISOString().slice(</span><span class="s11">0</span><span class="s1">, </span><span class="s11">10</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (sellModal) sellModal.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> handleEditButtonClick(event) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> tradeIdToEdit = event.target.dataset.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> tradeToEdit = trades.find(t =&gt; t.id === tradeIdToEdit);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (tradeToEdit) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (editTradeId) editTradeId.value = tradeToEdit.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (editSymbol) editSymbol.value = tradeToEdit.</span><span class="s7">symbol</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (editBuyPrice) editBuyPrice.value = tradeToEdit.buyPrice;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (editQuantity) editQuantity.value = tradeToEdit.quantity;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (editBuyFee) editBuyFee.value = tradeToEdit.buyFee || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (editTradeDate) editTradeDate.value = tradeToEdit.date;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (tradeToEdit.status === </span><span class="s8">'closed'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editSellPriceGroup) editSellPriceGroup.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editSellFeeGroup) editSellFeeGroup.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editSellDateGroup) editSellDateGroup.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editExitStrategyGroup) editExitStrategyGroup.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editSellPrice) editSellPrice.value = tradeToEdit.sellPrice || </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editSellFee) editSellFee.value = tradeToEdit.sellFee || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editSellDate) editSellDate.value = tradeToEdit.sellDate || </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editSellPriceGroup) editSellPriceGroup.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editSellFeeGroup) editSellFeeGroup.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editSellDateGroup) editSellDateGroup.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editExitStrategyGroup) editExitStrategyGroup.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editExitStrategy) editExitStrategy.value = tradeToEdit.exitStrategy !== </span><span class="s7">null</span><span class="s1"> ? tradeToEdit.exitStrategy : </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (editModal) editModal.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handleDeleteOpenTrade(event) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s4"> (!userId) { showMessage(</span><span class="s1">"Uživatel není přihlášen. Data nelze smazat."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">); </span><span class="s7">return</span><span class="s4">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> tradeIdToDelete = event.target.dataset.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> deleteDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${__app_id}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/trades`</span><span class="s1">, tradeIdToDelete));</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">'Otevřený obchod byl úspěšně smazán.'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error deleting open trade:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">"Chyba při mazání otevřeného obchodu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handleDeleteClosedTrade(event) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s4"> (!userId) { showMessage(</span><span class="s1">"Uživatel není přihlášen. Data nelze smazat."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">); </span><span class="s7">return</span><span class="s4">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> tradeIdToDelete = event.target.dataset.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> deleteDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${__app_id}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/trades`</span><span class="s1">, tradeIdToDelete));</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">'Uzavřený obchod byl úspěšně smazán.'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error deleting closed trade:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">"Chyba při mazání uzavřeného obchodu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handleEditPlannedTrade(event) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> plannedTradeIdToEdit = event.target.dataset.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>currentPlannedTradeToEdit = plannedTrades.find(pt =&gt; pt.id === plannedTradeIdToEdit);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (currentPlannedTradeToEdit) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (plannedCompanyInput) plannedCompanyInput.value = currentPlannedTradeToEdit.company;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (plannedEntryPriceInput) plannedEntryPriceInput.value = currentPlannedTradeToEdit.entryPrice;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (plannedExitPriceInput) plannedExitPriceInput.value = currentPlannedTradeToEdit.exitPrice;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (plannedQuantityInput) plannedQuantityInput.value = currentPlannedTradeToEdit.quantity;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">'Údaje plánovaného obchodu byly načteny do formuláře. Upravte a znovu uložte přes "Přidat Plánovaný Obchod".'</span><span class="s4">, </span><span class="s1">'info'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handleDeletePlannedTrade(event) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s4"> (!userId) { showMessage(</span><span class="s1">"Uživatel není přihlášen. Data nelze smazat."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">); </span><span class="s7">return</span><span class="s4">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> plannedTradeIdToDelete = event.target.dataset.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> deleteDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${__app_id}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/plannedTrades`</span><span class="s1">, plannedTradeIdToDelete));</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">'Plánovaný obchod byl úspěšně smazán.'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error deleting planned trade:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s1">"Chyba při mazání plánovaného obchodu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handleDeleteWithdrawal(event) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s4"> (!userId) { showMessage(</span><span class="s1">"Uživatel není přihlášen. Data nelze smazat."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">); </span><span class="s7">return</span><span class="s4">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> withdrawalIdToDelete = event.target.dataset.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">await</span><span class="s1"> deleteDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${__app_id}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/withdrawals`</span><span class="s1">, withdrawalIdToDelete));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s8">'Výběr byl úspěšně smazán.'</span><span class="s1">, </span><span class="s8">'success'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>console.error(</span><span class="s8">"Error deleting withdrawal:"</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>showMessage(</span><span class="s8">"Chyba při mazání výběru."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Initial setup</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// No initial render calls here, as they will be triggered by onSnapshot listeners after Firebase init.</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// NEW FUNCTION: Attach all event listeners to DOM elements</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">function</span><span class="s1"> attachAllEventListenersToDomElements() {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for setting initial balance</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (setInitialBalanceBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>setInitialBalanceBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen. Data nelze uložit."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> newInitialBalance = parseFloat(initialBalanceInput.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (isNaN(newInitialBalance) || newInitialBalance &lt; </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Zadejte prosím platný počáteční zůstatek (kladné číslo).'</span><span class="s4">, </span><span class="s1">'error'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> appId = </span><span class="s7">typeof</span><span class="s1"> __app_id !== </span><span class="s8">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s8">'default-app-id'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">await</span><span class="s1"> setDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/initialBalance`</span><span class="s1">, </span><span class="s8">'balance'</span><span class="s1">), { amount: newInitialBalance });</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Počáteční zůstatek byl úspěšně nastaven a uložen do cloudu.'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>console.error(</span><span class="s8">"Error setting initial balance:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">"Chyba při ukládání počátečního zůstatku do cloudu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for recording withdrawal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (recordWithdrawalBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>recordWithdrawalBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen. Data nelze uložit."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> amount = parseFloat(withdrawalAmountInput.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (isNaN(amount) || amount &lt;= </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Zadejte prosím platnou kladnou částku k výběru.'</span><span class="s4">, </span><span class="s1">'error'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">let</span><span class="s1"> currentCalculatedAvailableBalance = initialBalance - withdrawals.reduce((sum, w) =&gt; sum + w.amount, </span><span class="s11">0</span><span class="s1">) - trades.filter(t =&gt; t.status === </span><span class="s8">'open'</span><span class="s1">).reduce((sum, t) =&gt; sum + t.costBasis, </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (amount &gt; currentCalculatedAvailableBalance) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s8">`Částka k výběru (</span><span class="s1">${amount.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8"> USD) přesahuje dostupný zůstatek (</span><span class="s1">${currentCalculatedAvailableBalance.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8"> USD).`</span><span class="s1">, </span><span class="s8">'error'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> appId = </span><span class="s7">typeof</span><span class="s1"> __app_id !== </span><span class="s8">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s8">'default-app-id'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">await</span><span class="s1"> addDoc(collection(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/withdrawals`</span><span class="s1">), {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>amount: amount,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>date: </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Date</span><span class="s1">().toISOString().slice(</span><span class="s11">0</span><span class="s1">, </span><span class="s11">10</span><span class="s1">),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>timestamp: </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Date</span><span class="s1">() </span><span class="s10">// Add timestamp for ordering</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>withdrawalAmountInput.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s8">`Výběr </span><span class="s1">${amount.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8"> USD byl zaznamenán a uložen do cloudu.`</span><span class="s1">, </span><span class="s8">'success'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>console.error(</span><span class="s8">"Error recording withdrawal:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">"Chyba při ukládání výběru do cloudu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for "View Withdrawal History" button</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (viewWithdrawalHistoryBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>viewWithdrawalHistoryBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>renderWithdrawalHistory();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (withdrawalHistoryModal) withdrawalHistoryModal.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for "Close Withdrawal History" button</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (closeWithdrawalHistoryBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>closeWithdrawalHistoryBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (withdrawalHistoryModal) withdrawalHistoryModal.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for adding a trade (main trades)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (addTradeBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>addTradeBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen. Data nelze uložit."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> </span><span class="s7">symbol</span><span class="s1"> = tradeStockSymbol.value.trim().toUpperCase();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> buyPrice = parseFloat(tradeBuyPrice.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> quantity = parseInt(tradeQuantity.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> buyFee = parseFloat(tradeBuyFee.value) || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> date = tradeDate.value;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!</span><span class="s7">symbol</span><span class="s1"> || isNaN(buyPrice) || isNaN(quantity) || !date || buyPrice &lt;= </span><span class="s11">0</span><span class="s1"> || quantity &lt;= </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Vyplňte prosím všechna pole pro obchod platnými hodnotami.'</span><span class="s4">, </span><span class="s1">'warning'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> costBasis = (buyPrice * quantity) + buyFee;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">let</span><span class="s1"> currentCalculatedAvailableBalance = initialBalance - withdrawals.reduce((sum, w) =&gt; sum + w.amount, </span><span class="s11">0</span><span class="s1">) - trades.filter(t =&gt; t.status === </span><span class="s8">'open'</span><span class="s1">).reduce((sum, t) =&gt; sum + t.costBasis, </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (costBasis &gt; currentCalculatedAvailableBalance) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s8">`Nedostatečný disponibilní zůstatek pro nákup. Potřebujete </span><span class="s12">$</span><span class="s1">${costBasis.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">, máte </span><span class="s12">$</span><span class="s1">${currentCalculatedAvailableBalance.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8">.`</span><span class="s1">, </span><span class="s8">'error'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> newTrade = {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">symbol</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>buyPrice,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>quantity,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>buyFee,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>date,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>status: </span><span class="s8">'open'</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>costBasis: costBasis,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>exitStrategy: </span><span class="s7">null</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>timestamp: </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Date</span><span class="s1">()</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>};</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> appId = </span><span class="s7">typeof</span><span class="s1"> __app_id !== </span><span class="s8">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s8">'default-app-id'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">await</span><span class="s1"> addDoc(collection(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/trades`</span><span class="s1">), newTrade);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> (tradeStockSymbol) tradeStockSymbol.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> (tradeBuyPrice) tradeBuyPrice.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> (tradeQuantity) tradeQuantity.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> (tradeBuyFee) tradeBuyFee.value = </span><span class="s8">'0'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> (tradeDate) tradeDate.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Obchod byl úspěšně přidán a uložen do cloudu!'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>console.error(</span><span class="s8">"Error adding trade:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">"Chyba při ukládání obchodu do cloudu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Tab functionality</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (openTradesTab) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>openTradesTab.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>openTradesTab.classList.add(</span><span class="s8">'active'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (closedTradesTab) closedTradesTab.classList.remove(</span><span class="s8">'active'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (openTradesSection) openTradesSection.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (closedTradesSection) closedTradesSection.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (closedTradesTab) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>closedTradesTab.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>closedTradesTab.classList.add(</span><span class="s8">'active'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (openTradesTab) openTradesTab.classList.remove(</span><span class="s8">'active'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (closedTradesSection) closedTradesSection.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (openTradesSection) openTradesSection.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Cancel button for sell modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (cancelSellBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>cancelSellBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (sellModal) sellModal.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>currentTradeToSell = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Confirm sell button for sell modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (confirmSellBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>confirmSellBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen. Data nelze uložit."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> sellPrice = parseFloat(modalSellPrice.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> sellFee = parseFloat(modalSellFee.value) || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> sellDate = modalSellDate.value;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (isNaN(sellPrice) || sellPrice &lt;= </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s8">'Neplatná prodejní cena.'</span><span class="s1">, </span><span class="s8">'error'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!sellDate) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s8">'Datum prodeje je povinné.'</span><span class="s1">, </span><span class="s8">'error'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (currentTradeToSell) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> tradeRef = doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${__app_id}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/trades`</span><span class="s1">, currentTradeToSell.id);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> grossProfit = (sellPrice - currentTradeToSell.buyPrice) * currentTradeToSell.quantity;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> profitLoss = grossProfit - (currentTradeToSell.buyFee || </span><span class="s11">0</span><span class="s1">) - (sellFee || </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> tax = profitLoss &gt; </span><span class="s11">0</span><span class="s1"> ? profitLoss * </span><span class="s11">0.15</span><span class="s1"> : </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">await</span><span class="s1"> updateDoc(tradeRef, {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>sellPrice: sellPrice,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>sellFee: sellFee,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>sellDate: sellDate,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>status: </span><span class="s8">'closed'</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>profitLoss: profitLoss,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                    </span>tax: tax</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>});</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                                </span>showMessage(</span><span class="s1">'Obchod byl úspěšně uzavřen a uložen do cloudu.'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>console.error(</span><span class="s8">"Error closing trade:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                                </span>showMessage(</span><span class="s1">"Chyba při ukládání uzavřeného obchodu do cloudu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (sellModal) sellModal.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>currentTradeToSell = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Cancel button for edit modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (cancelEditBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>cancelEditBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editModal) editModal.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Confirm edit button for edit modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (confirmEditBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>confirmEditBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen. Data nelze uložit."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> tradeId = editTradeId.value;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> tradeRef = doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${__app_id}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/trades`</span><span class="s1">, tradeId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> originalTrade = trades.find(t =&gt; t.id === tradeId);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!originalTrade) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Chyba: Obchod k úpravě nebyl nalezen.'</span><span class="s4">, </span><span class="s1">'error'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> </span><span class="s7">symbol</span><span class="s1"> = editSymbol.value.trim().toUpperCase();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> buyPrice = parseFloat(editBuyPrice.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> quantity = parseInt(editQuantity.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> buyFee = parseFloat(editBuyFee.value) || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> date = editTradeDate.value;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!</span><span class="s7">symbol</span><span class="s1"> || isNaN(buyPrice) || isNaN(quantity) || !date || buyPrice &lt;= </span><span class="s11">0</span><span class="s1"> || quantity &lt;= </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Vyplňte prosím všechna povinná pole platnými hodnotami.'</span><span class="s4">, </span><span class="s1">'warning'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> updatedFields = {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">symbol</span><span class="s1">: </span><span class="s7">symbol</span><span class="s1">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>buyPrice: buyPrice,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>quantity: quantity,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>buyFee: buyFee,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>date: date,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>costBasis: (buyPrice * quantity) + buyFee</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>};</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (originalTrade.status === </span><span class="s8">'closed'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> sellPrice = parseFloat(editSellPrice.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> sellFee = parseFloat(editSellFee.value) || </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> sellDate = editSellDate.value;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> (isNaN(sellPrice) || sellPrice &lt;= </span><span class="s11">0</span><span class="s1"> || !sellDate) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                                </span>showMessage(</span><span class="s1">'Vyplňte prosím platnou prodejní cenu a datum prodeje.'</span><span class="s4">, </span><span class="s1">'warning'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>updatedFields.sellPrice = sellPrice;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>updatedFields.sellFee = sellFee;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>updatedFields.sellDate = sellDate;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> grossProfit = (sellPrice - updatedFields.buyPrice) * updatedFields.quantity;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>updatedFields.profitLoss = grossProfit - (updatedFields.buyFee || </span><span class="s11">0</span><span class="s1">) - (updatedFields.sellFee || </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>updatedFields.tax = updatedFields.profitLoss &gt; </span><span class="s11">0</span><span class="s1"> ? updatedFields.profitLoss * </span><span class="s11">0.15</span><span class="s1"> : </span><span class="s11">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> exitStrategy = parseFloat(editExitStrategy.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>updatedFields.exitStrategy = isNaN(exitStrategy) ? </span><span class="s7">null</span><span class="s1"> : exitStrategy;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">await</span><span class="s1"> updateDoc(tradeRef, updatedFields);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Obchod byl úspěšně upraven a uložen do cloudu.'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>console.error(</span><span class="s8">"Error updating trade:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">"Chyba při ukládání úprav obchodu do cloudu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (editModal) editModal.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for "Přidat Plánovaný Obchod" button</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (addPlannedTradeBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>addPlannedTradeBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> company = plannedCompanyInput.value.trim();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> entryPrice = parseFloat(plannedEntryPriceInput.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> exitPrice = parseFloat(plannedExitPriceInput.value);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> quantity = parseInt(plannedQuantityInput.value);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!company || isNaN(entryPrice) || isNaN(exitPrice) || isNaN(quantity) || entryPrice &lt;= </span><span class="s11">0</span><span class="s1"> || exitPrice &lt;= </span><span class="s11">0</span><span class="s1"> || quantity &lt;= </span><span class="s11">0</span><span class="s1">) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Vyplňte prosím všechna pole pro plánovaný obchod platnými hodnotami.'</span><span class="s4">, </span><span class="s1">'warning'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> investedAmountForPlannedTrade = entryPrice * quantity;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">let</span><span class="s1"> currentAvailableForPlannedInvestment = initialBalance - withdrawals.reduce((sum, w) =&gt; sum + w.amount, </span><span class="s11">0</span><span class="s1">) - trades.filter(t =&gt; t.status === </span><span class="s8">'open'</span><span class="s1">).reduce((sum, t) =&gt; sum + t.costBasis, </span><span class="s11">0</span><span class="s1">) - plannedTrades.reduce((sum, pt) =&gt; sum + (pt.entryPrice * pt.quantity || </span><span class="s11">0</span><span class="s1">), </span><span class="s11">0</span><span class="s1">);</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (investedAmountForPlannedTrade &gt; currentAvailableForPlannedInvestment) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s8">`Plánovaná investovaná částka (</span><span class="s1">${investedAmountForPlannedTrade.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8"> USD) přesahuje dostupný kapitál k plánování/investování (</span><span class="s1">${currentAvailableForPlannedInvestment.toFixed(</span><span class="s11">2</span><span class="s1">)}</span><span class="s8"> USD).`</span><span class="s1">, </span><span class="s8">'error'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>currentPlannedTradeToEdit = {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>id: currentPlannedTradeToEdit ? currentPlannedTradeToEdit.id : crypto.randomUUID(),</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>company,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>entryPrice,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>exitPrice,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>quantity,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>investedAmount: investedAmountForPlannedTrade,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>answers: currentPlannedTradeToEdit ? currentPlannedTradeToEdit.answers : {}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>};</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>renderQuestionsInModal();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (plannedTradeQuestionsModal) plannedTradeQuestionsModal.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Render questions in the planned trade questions modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">function</span><span class="s1"> renderQuestionsInModal() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (!questionsContainer) </span><span class="s7">return</span><span class="s1">; </span><span class="s10">// Ensure element exists</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>questionsContainer.innerHTML = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>tradeQuestions.forEach(q =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> questionDiv = document.createElement(</span><span class="s8">'div'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>questionDiv.className = </span><span class="s8">'mb-2'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>questionDiv.innerHTML = </span><span class="s8">`</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;p class="text-gray-800"&gt;</span><span class="s4">${q.text}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center gap-4 mt-1"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="inline-flex items-center"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;input type="radio" class="form-radio text-blue-600" name="question-</span><span class="s4">${q.id}</span><span class="s1">" value="Ano" </span><span class="s4">${currentPlannedTradeToEdit &amp;&amp; currentPlannedTradeToEdit.answers[q.id] === </span><span class="s1">'Ano'</span><span class="s4"> ? </span><span class="s1">'checked'</span><span class="s4"> : </span><span class="s1">''</span><span class="s4">}</span><span class="s1">&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;span class="ml-2 text-gray-700"&gt;Ano&lt;/span&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/label&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="inline-flex items-center"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;input type="radio" class="form-radio text-red-600" name="question-</span><span class="s4">${q.id}</span><span class="s1">" value="Ne" </span><span class="s4">${currentPlannedTradeToEdit &amp;&amp; currentPlannedTradeToEdit.answers[q.id] === </span><span class="s1">'Ne'</span><span class="s4"> ? </span><span class="s1">'checked'</span><span class="s4"> : </span><span class="s1">''</span><span class="s4">}</span><span class="s1">&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;span class="ml-2 text-gray-700"&gt;Ne&lt;/span&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/label&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>questionsContainer.appendChild(questionDiv);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for "Potvrdit a Uložit" in planned trade questions modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (confirmQuestionsBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>confirmQuestionsBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen. Data nelze uložit."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">let</span><span class="s1"> allAnsweredYes = </span><span class="s7">true</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> answers = {};</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>tradeQuestions.forEach(q =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> selected = document.querySelector(</span><span class="s8">`input[name="question-</span><span class="s1">${q.id}</span><span class="s8">"]:checked`</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> (!selected || selected.value !== </span><span class="s8">'Ano'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>allAnsweredYes = </span><span class="s7">false</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>answers[q.id] = selected ? selected.value : </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>});</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!allAnsweredYes) {</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Musíte odpovědět "Ano" na všechny otázky, abyste mohli uložit plánovaný obchod.'</span><span class="s4">, </span><span class="s1">'error'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>currentPlannedTradeToEdit.answers = answers;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> appId = </span><span class="s7">typeof</span><span class="s1"> __app_id !== </span><span class="s8">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s8">'default-app-id'</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> (plannedTrades.some(pt =&gt; pt.id === currentPlannedTradeToEdit.id)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">const</span><span class="s1"> plannedTradeRef = doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/plannedTrades`</span><span class="s1">, currentPlannedTradeToEdit.id);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">await</span><span class="s1"> setDoc(plannedTradeRef, currentPlannedTradeToEdit);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                                </span>showMessage(</span><span class="s1">'Plánovaný obchod byl úspěšně upraven a uložen do cloudu.'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">await</span><span class="s1"> addDoc(collection(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/plannedTrades`</span><span class="s1">), currentPlannedTradeToEdit);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                                </span>showMessage(</span><span class="s1">'Plánovaný obchod byl úspěšně přidán a uložen do cloudu!'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>console.error(</span><span class="s8">"Error saving planned trade:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">"Chyba při ukládání plánovaného obchodu do cloudu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (plannedTradeQuestionsModal) plannedTradeQuestionsModal.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (plannedCompanyInput) plannedCompanyInput.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (plannedEntryPriceInput) plannedEntryPriceInput.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (plannedExitPriceInput) plannedExitPriceInput.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (plannedQuantityInput) plannedQuantityInput.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>currentPlannedTradeToEdit = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for "Zrušit" in planned trade questions modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (cancelQuestionsBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>cancelQuestionsBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (plannedTradeQuestionsModal) plannedTradeQuestionsModal.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>currentPlannedTradeToEdit = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for "Spravovat Otázky" button</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (manageQuestionsBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>manageQuestionsBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>renderManageQuestionsModal();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (manageQuestionsModal) manageQuestionsModal.classList.remove(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Render questions in the manage questions modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">function</span><span class="s1"> renderManageQuestionsModal() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (!currentQuestionsList) </span><span class="s7">return</span><span class="s1">; </span><span class="s10">// Ensure element exists</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>currentQuestionsList.innerHTML = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>tradeQuestions.forEach(q =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> questionItemDiv = document.createElement(</span><span class="s8">'div'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>questionItemDiv.className = </span><span class="s8">'question-item'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>questionItemDiv.innerHTML = </span><span class="s8">`</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="text" class="question-input" data-question-id="</span><span class="s4">${q.id}</span><span class="s1">" value="</span><span class="s4">${q.text}</span><span class="s1">"&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button data-question-id="</span><span class="s4">${q.id}</span><span class="s1">" class="text-red-500 hover:text-red-700 font-semibold ml-4 remove-question-btn"&gt;Smazat&lt;/button&gt;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                        </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>currentQuestionsList.appendChild(questionItemDiv);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>document.querySelectorAll(</span><span class="s8">'.remove-question-btn'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>button.removeEventListener(</span><span class="s8">'click'</span><span class="s1">, handleRemoveQuestion);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>button.addEventListener(</span><span class="s8">'click'</span><span class="s1">, handleRemoveQuestion);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event handler for removing a question</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">async</span><span class="s1"> </span><span class="s7">function</span><span class="s1"> handleRemoveQuestion(event) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen. Data nelze smazat."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> questionIdToRemove = event.target.dataset.questionId;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> updatedQuestions = tradeQuestions.filter(q =&gt; q.id !== questionIdToRemove);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> appId = </span><span class="s7">typeof</span><span class="s1"> __app_id !== </span><span class="s8">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s8">'default-app-id'</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">await</span><span class="s1"> setDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/tradeQuestions`</span><span class="s1">, </span><span class="s8">'questions'</span><span class="s1">), { list: updatedQuestions });</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                        </span>showMessage(</span><span class="s1">'Otázka byla smazána a změny uloženy.'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>console.error(</span><span class="s8">"Error deleting question:"</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>showMessage(</span><span class="s8">"Chyba při mazání otázky."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for "Přidat Otázku" button in manage questions modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (addNewQuestionBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>addNewQuestionBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen. Data nelze uložit."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> newQuestionText = newQuestionInput.value.trim();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (newQuestionText) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> newQuestion = { id: crypto.randomUUID(), text: newQuestionText };</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> updatedQuestions = [...tradeQuestions, newQuestion];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> appId = </span><span class="s7">typeof</span><span class="s1"> __app_id !== </span><span class="s8">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s8">'default-app-id'</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">await</span><span class="s1"> setDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/tradeQuestions`</span><span class="s1">, </span><span class="s8">'questions'</span><span class="s1">), { list: updatedQuestions });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span></span><span class="s7">if</span><span class="s1"> (newQuestionInput) newQuestionInput.value = </span><span class="s8">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>showMessage(</span><span class="s8">'Nová otázka byla přidána a uložena.'</span><span class="s1">, </span><span class="s8">'success'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>console.error(</span><span class="s8">"Error adding new question:"</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                                </span>showMessage(</span><span class="s8">"Chyba při přidávání nové otázky."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s8">'Prosím zadejte text nové otázky.'</span><span class="s1">, </span><span class="s8">'warning'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for "Uložit Změny" in manage questions modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (saveQuestionsBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>saveQuestionsBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, </span><span class="s7">async</span><span class="s1"> () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (!userId) { showMessage(</span><span class="s8">"Uživatel není přihlášen. Data nelze uložit."</span><span class="s1">, </span><span class="s8">"error"</span><span class="s1">); </span><span class="s7">return</span><span class="s1">; }</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> updatedQuestionsList = [];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>document.querySelectorAll(</span><span class="s8">'#currentQuestionsList .question-input'</span><span class="s1">).forEach(input =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> questionId = input.dataset.questionId;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">const</span><span class="s1"> updatedText = input.value.trim();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>updatedQuestionsList.push({ id: questionId, text: updatedText });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">const</span><span class="s1"> appId = </span><span class="s7">typeof</span><span class="s1"> __app_id !== </span><span class="s8">'undefined'</span><span class="s1"> ? __app_id : </span><span class="s8">'default-app-id'</span><span class="s1">;</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">await</span><span class="s1"> setDoc(doc(db, </span><span class="s8">`artifacts/</span><span class="s1">${appId}</span><span class="s8">/users/</span><span class="s1">${userId}</span><span class="s8">/tradeQuestions`</span><span class="s1">, </span><span class="s8">'questions'</span><span class="s1">), { list: updatedQuestionsList });</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s7">if</span><span class="s1"> (manageQuestionsModal) manageQuestionsModal.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">'Změny otázek byly uloženy do cloudu.'</span><span class="s4">, </span><span class="s1">'success'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                            </span>console.error(</span><span class="s8">"Error saving questions changes:"</span><span class="s1">, e);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                            </span>showMessage(</span><span class="s1">"Chyba při ukládání změn otázek do cloudu."</span><span class="s4">, </span><span class="s1">"error"</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Event listener for "Zrušit" in manage questions modal</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (cancelManageQuestionsBtn) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>cancelManageQuestionsBtn.addEventListener(</span><span class="s8">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s7">if</span><span class="s1"> (manageQuestionsModal) manageQuestionsModal.classList.add(</span><span class="s8">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>renderManageQuestionsModal();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>} </span><span class="s1">// End of attachAllEventListenersToDomElements function</span></p>
<p class="p8"><span class="s9"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>}); </span><span class="s1">// End of DOMContentLoaded</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s9"></span><br></p>
</body>
</html>
